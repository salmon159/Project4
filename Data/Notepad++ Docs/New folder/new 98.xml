<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output encoding="UTF-8" indent="yes" method="xml" omit-xml-declaration="yes"/>
    <xsl:template match="/OrderHeader">
        <OrderHeader>
            <xsl:variable name="VarCountry">
                <xsl:value-of select="CustomerMaster/@Country"/>
            </xsl:variable>
            <xsl:attribute name="LocationCode">
                <xsl:value-of select="@LocationCode"/>
            </xsl:attribute>
            <xsl:attribute name="StoreCustomer">
                <xsl:value-of select="@StoreCustomer"/>
            </xsl:attribute>
            <xsl:attribute name="ShipmentNo">
                <xsl:value-of select="@ShipmentNo"/>
            </xsl:attribute>
            <xsl:attribute name="ShipmentType">
                <xsl:value-of select="@ShipmentType"/>
            </xsl:attribute>
            <xsl:attribute name="NodeType">
                <xsl:value-of select="@NodeType"/>
            </xsl:attribute>
            <xsl:attribute name="DeliveryMethod">
                <xsl:value-of select="@DeliveryMethod"/>
            </xsl:attribute>
            <!--Myntra ordername changes start-->
            <xsl:attribute name="EntryType">
                <xsl:value-of select="@EntryType"/>
            </xsl:attribute>
            <xsl:attribute name="OrderName">
                <xsl:value-of select="@OrderName"/>
            </xsl:attribute>
            <!--Myntra ordername changes END-->
            <xsl:attribute name="OrderNo">
                <xsl:value-of select="@OrderNo"/>
            </xsl:attribute>
            <xsl:attribute name="ShipmentDate">
                <xsl:value-of select="@ShipmentDate"/>
            </xsl:attribute>
            <xsl:attribute name="OrderDate">
                <xsl:value-of select="@OrderDate"/>
            </xsl:attribute>
            <xsl:attribute name="CustomerNo">
                <xsl:value-of select="@CustomerNo"/>
            </xsl:attribute>
            <xsl:attribute name="OrderSource">
                <xsl:value-of select="@OrderSource"/>
            </xsl:attribute>
            <xsl:attribute name="OrderStatus">
                <xsl:value-of select="@OrderStatus"/>
            </xsl:attribute>
            <xsl:attribute name="ExpectedShipmentDate">
                <xsl:value-of select="@ExpectedShipmentDate"/>
            </xsl:attribute>
            <xsl:attribute name="ExpectedDeliveryDate">
                <xsl:value-of select="@ExpectedDeliveryDate"/>
            </xsl:attribute>
            <xsl:attribute name="ServiceLevel">
                <xsl:value-of select="@ServiceLevel"/>
            </xsl:attribute>
            <xsl:attribute name="AirwayBillNo">
                <xsl:value-of select="@AirwayBillNo"/>
            </xsl:attribute>
            <xsl:attribute name="CarrierName">
                <xsl:value-of select="@CarrierName"/>
            </xsl:attribute>
            <xsl:attribute name="CustomerVerificationID">
                <xsl:value-of select="@CustomerVerificationID"/>
            </xsl:attribute>
            <xsl:attribute name="OrderExpiryDate">
                <xsl:value-of select="@OrderExpiryDate"/>
            </xsl:attribute>
            <xsl:attribute name="TotalOrderValue">
                <xsl:value-of select="@TotalOrderValue"/>
            </xsl:attribute>
            <xsl:attribute name="CODAmount">
                <xsl:value-of select="@CODAmount"/>
            </xsl:attribute>
            <xsl:attribute name="PaidAmount">
                <xsl:value-of select="@PaidAmount"/>
            </xsl:attribute>
            <xsl:attribute name="SourceTypeID">
                <xsl:value-of select="@SourceTypeID"/>
            </xsl:attribute>
            <xsl:attribute name="Text1">
                <xsl:value-of select="@Text1"/>
            </xsl:attribute>
            <xsl:attribute name="Text2">
                <xsl:value-of select="@Text2"/>
            </xsl:attribute>
            <xsl:attribute name="Text3">
                <xsl:value-of select="@Text3"/>
            </xsl:attribute>
            <xsl:attribute name="Text6">
                <xsl:value-of select="@Text6"/>
            </xsl:attribute>
            <xsl:if test="@ShippingCharge!=''">
                <xsl:attribute name="ShippingCharge">
                    <xsl:value-of select="@ShippingCharge"/>
                </xsl:attribute>
            </xsl:if>
            <CustomerMaster>
                <xsl:attribute name="Title">
                    <xsl:value-of select="CustomerMaster/@Title"/>
                </xsl:attribute>
                <xsl:attribute name="FirstName">
                    <xsl:value-of select="CustomerMaster/@FirstName"/>
                </xsl:attribute>
                <xsl:attribute name="MiddleName">
                    <xsl:value-of select="CustomerMaster/@MiddleName"/>
                </xsl:attribute>
                <xsl:attribute name="LastName">
                    <xsl:value-of select="CustomerMaster/@LastName"/>
                </xsl:attribute>
                <xsl:attribute name="CountryCode">
                    <xsl:value-of select="CustomerMaster/@CountryCode"/>
                </xsl:attribute>
                <xsl:attribute name="Country">
                    <xsl:value-of select="CustomerMaster/@Country"/>
                </xsl:attribute>
                <xsl:attribute name="EMailID">
                    <xsl:value-of select="CustomerMaster/@EMailID"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine1">
                    <xsl:value-of select="CustomerMaster/@AddressLine1"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine2">
                    <xsl:value-of select="CustomerMaster/@AddressLine2"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine3">
                    <xsl:value-of select="CustomerMaster/@AddressLine3"/>
                </xsl:attribute>
                <xsl:attribute name="TownName">
                    <xsl:value-of select="CustomerMaster/@TownName"/>
                </xsl:attribute>
                <xsl:attribute name="State">
                    <xsl:value-of select="CustomerMaster/@State"/>
                </xsl:attribute>
                <xsl:attribute name="PinCode">
                    <xsl:value-of select="CustomerMaster/@PinCode"/>
                </xsl:attribute>
                <xsl:attribute name="MobileNo">
                    <xsl:value-of select="CustomerMaster/@MobileNo"/>
                </xsl:attribute>
                <xsl:attribute name="IsNRI">
                    <xsl:value-of select="CustomerMaster/@IsNRI"/>
                </xsl:attribute>
                <xsl:attribute name="LoyaltyNo">
                    <xsl:value-of select="CustomerMaster/@LoyaltyNo"/>
                </xsl:attribute>
            </CustomerMaster>
            <ToAddress>
                <xsl:attribute name="Title">
                    <xsl:value-of select="ToAddress/@Title"/>
                </xsl:attribute>
                <xsl:attribute name="FirstName">
                    <xsl:value-of select="ToAddress/@FirstName"/>
                </xsl:attribute>
                <xsl:attribute name="MiddleName">
                    <xsl:value-of select="ToAddress/@MiddleName"/>
                </xsl:attribute>
                <xsl:attribute name="LastName">
                    <xsl:value-of select="ToAddress/@LastName"/>
                </xsl:attribute>
                <xsl:attribute name="CountryCode">
                    <xsl:value-of select="ToAddress/@CountryCode"/>
                </xsl:attribute>
                <xsl:attribute name="Country">
                    <xsl:value-of select="ToAddress/@Country"/>
                </xsl:attribute>
                <xsl:attribute name="EMailID">
                    <xsl:value-of select="ToAddress/@EMailID"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine1">
                    <xsl:value-of select="ToAddress/@AddressLine1"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine2">
                    <xsl:value-of select="ToAddress/@AddressLine2"/>
                </xsl:attribute>
                <xsl:attribute name="AddressLine3">
                    <xsl:value-of select="ToAddress/@AddressLine3"/>
                </xsl:attribute>
                <xsl:attribute name="TownName">
                    <xsl:value-of select="ToAddress/@TownName"/>
                </xsl:attribute>
                <xsl:attribute name="State">
                    <xsl:value-of select="ToAddress/@State"/>
                </xsl:attribute>
                <xsl:attribute name="PinCode">
                    <xsl:value-of select="ToAddress/@PinCode"/>
                </xsl:attribute>
                <xsl:attribute name="MobileNo">
                    <xsl:value-of select="ToAddress/@MobileNo"/>
                </xsl:attribute>
                <xsl:attribute name="Country">
                    <xsl:value-of select="ToAddress/@Country"/>
                </xsl:attribute>
            </ToAddress>
            <OrderDetail>
                <!-- For each lines -->
                <xsl:for-each select="OrderDetail/OrderLine">
                    <OrderLine>
                        <xsl:attribute name="LineItemNo">
                            <xsl:value-of select="@LineItemNo"/>
                        </xsl:attribute>
                        <xsl:attribute name="ItemCode">
                            <xsl:value-of select="@ItemCode"/>
                        </xsl:attribute>
                        <xsl:attribute name="LotNumber">
                            <xsl:value-of select="@LotNumber"/>
                        </xsl:attribute>
                        <xsl:attribute name="Quantity">
                            <xsl:value-of select="@Quantity"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderLineStatus">
                            <xsl:value-of select="@OrderLineStatus"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderUnitPrice">
                            <xsl:value-of select="@OrderUnitPrice"/>
                        </xsl:attribute>
                        <xsl:attribute name="SalesPrice">
                            <xsl:value-of select="@SalesPrice"/>
                        </xsl:attribute>
                        <xsl:attribute name="GiftMessage">
                            <xsl:value-of select="@GiftMessage"/>
                        </xsl:attribute>
                        <xsl:attribute name="ManufacturerItemDesc">
                            <xsl:value-of select="@ManufacturerItemDesc"/>
                        </xsl:attribute>
                        <xsl:attribute name="ImageID">
                            <xsl:value-of select="@ImageID"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderType">
                            <xsl:value-of select="@OrderType"/>
                        </xsl:attribute>
                        <xsl:attribute name="isFOC">
                            <xsl:value-of select="@isFOC"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderedGrossWeight">
                            <xsl:value-of select="@OrderedGrossWeight"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderedQty">
                            <xsl:value-of select="@OrderedQty"/>
                        </xsl:attribute>
                        <xsl:attribute name="DiamondWeight">
                            <xsl:value-of select="@DiamondWeight"/>
                        </xsl:attribute>
                        <xsl:attribute name="StoneWeight">
                            <xsl:value-of select="@StoneWeight"/>
                        </xsl:attribute>
                        <xsl:attribute name="NetWeight">
                            <xsl:value-of select="@NetWeight"/>
                        </xsl:attribute>
                        <xsl:attribute name="GoldRate">
                            <xsl:value-of select="@GoldRate"/>
                        </xsl:attribute>
                        <xsl:attribute name="GoldValue">
                            <xsl:value-of select="@GoldValue"/>
                        </xsl:attribute>
                        <xsl:attribute name="StoneValue">
                            <xsl:value-of select="@StoneValue"/>
                        </xsl:attribute>
                        <xsl:attribute name="BullionRate">
                            <xsl:value-of select="@BullionRate"/>
                        </xsl:attribute>
                        <xsl:attribute name="MakingChargesPercentage">
                            <xsl:value-of select="@ExtnWastagePercentage + @ExtnMakingChargesPercentage"/>
                        </xsl:attribute>
                        <xsl:attribute name="MakingChargesValue">
                            <xsl:value-of select="@ExtnMakingCharges + @ExtnMakingChargesStudded + @ExtnWastageCharges"/>
                        </xsl:attribute>
                        <xsl:attribute name="EmployeeCode">
                            <xsl:value-of select="@EmployeeCode"/>
                        </xsl:attribute>
                        <xsl:attribute name="OrderLineValue">
                            <xsl:value-of select="@OrderLineValue"/>
                        </xsl:attribute>
                        <xsl:attribute name="DollarRate">
                            <xsl:value-of select="@DollarRate"/>
                        </xsl:attribute>
                        <xsl:attribute name="IDProofType">
                            <xsl:value-of select="@IDProofType"/>
                        </xsl:attribute>
                        <xsl:attribute name="IDProofValue">
                            <xsl:value-of select="@IDProofValue"/>
                        </xsl:attribute>
                        <xsl:attribute name="PickupUserFirstName">
                            <xsl:value-of select="@PickupUserFirstName"/>
                        </xsl:attribute>
                        <xsl:attribute name="PickupUserLastName">
                            <xsl:value-of select="@PickupUserLastName"/>
                        </xsl:attribute>
                        <xsl:attribute name="PickupUserPhoneNo">
                            <xsl:value-of select="@PickupUserPhoneNo"/>
                        </xsl:attribute>
                        <xsl:attribute name="PickupUserEmailID">
                            <xsl:value-of select="@PickupUserEmailID"/>
                        </xsl:attribute>
                        <xsl:attribute name="ConditionVariable2">
                            <xsl:value-of select="@ConditionVariable2"/>
                        </xsl:attribute>
                        <!-- Sum of OtherChargesTax at line detail level -->
                        <xsl:attribute name="OtherChargesTax2">
                            <xsl:value-of select="sum(LineTaxes/LineTax/@OtherTax2)"/>
                        </xsl:attribute>
                        <!-- 
                        <xsl:variable name="StoreOtherChargesTax1" select="sum(LineTaxes/LineTax/@OtherTax1)"/><xsl:variable name="StoreOtherChargesTax2" select="sum(LineTaxes/LineTax/@OtherTax2)"/><xsl:attribute name="LineOtherCharges"><xsl:value-of select="($StoreOtherChargesTax1 + $StoreOtherChargesTax2)"/></xsl:attribute> -->
                        <!-- Sum of PriceTax at line detail level -->
                        <xsl:attribute name="Tax2">
                            <xsl:value-of select="sum(LineTaxes/LineTax/@PriceTax2)"/>
                        </xsl:attribute>
                        <xsl:variable name="StoreLinePriceTax2" select="sum(LineTaxes/LineTax/@PriceTax2)"/>
                        <xsl:attribute name="TotalTax">
                            <xsl:value-of select="$StoreLinePriceTax2"/>
                        </xsl:attribute>
                        <xsl:attribute name="ShippingTax">
                            <xsl:value-of select="sum(LineTaxes/LineTax/@ShipTax)"/>
                        </xsl:attribute>
                        <!-- sum of OtherCharges at lineCharges Level and bring it to Line level -->
                        <xsl:attribute name="OtherCharges">
                            <xsl:value-of select="sum(LineCharges/LineCharge/@OtherChargesLineChargeLevel)"/>
                        </xsl:attribute>
                        <!-- Add ERPDiscountType and ERPDiscountValue at OrderDetail -->
                        <xsl:attribute name="ERPDiscountType">
                            <xsl:value-of select="LineCharges/LineCharge/@ERPDiscountType"/>
                        </xsl:attribute>
                        <xsl:attribute name="ERPDiscountValue">
                            <xsl:value-of select="LineCharges/LineCharge/@ERPDiscountValue"/>
                        </xsl:attribute>
                        <TitanPaymentDetailList>
                            <xsl:for-each select="TitanPaymentDetailList/TitanPaymentDetail">
                                <TitanPaymentDetail>
                                    <xsl:attribute name="LineItemNo">
                                    <xsl:value-of select="@LineItemNo"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="PaymentCode">
                                    <xsl:value-of select="@PaymentCode"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="Amount">
                                    <xsl:value-of select="@Amount"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="GCKey">
                                    <xsl:value-of select="@GCKey"/>
                                    </xsl:attribute>
                                </TitanPaymentDetail>
                            </xsl:for-each>
                        </TitanPaymentDetailList>
                        <xsl:copy-of select="TitanGCLineDetailList"/>
                        <LineTaxes>
                            <xsl:for-each select="LineTaxes/LineTax">
                                <LineTax>
                                    <xsl:attribute name="Quantity">
                                    <xsl:value-of select="@Quantity"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="TaxName">
                                    <xsl:value-of select="@TaxName"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="Reference1">
                                    <xsl:value-of select="@Reference1"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargeCategory">
                                    <xsl:value-of select="@ChargeCategory"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargeName">
                                    <xsl:value-of select="@ChargeName"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="Tax">
                                    <xsl:value-of select="@Tax"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="TaxPercentage">
                                    <xsl:value-of select="@TaxPercentage"/>
                                    </xsl:attribute>
                                </LineTax>
                            </xsl:for-each>
                        </LineTaxes>
                        <LineCharges>
                            <xsl:for-each select="LineCharges/LineCharge">
                                <LineCharge>
                                    <xsl:attribute name="Quantity">
                                    <xsl:value-of select="@Quantity"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargeName">
                                    <xsl:value-of select="@ChargeName"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargeCategory">
                                    <xsl:value-of select="@ChargeCategory"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargeAmount">
                                    <xsl:value-of select="@ChargeAmount"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="ChargePerUnit">
                                    <xsl:value-of select="@ChargePerUnit"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="Reference">
                                    <xsl:value-of select="@Reference"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="IsDiscount">
                                    <xsl:value-of select="@IsDiscount"/>
                                    </xsl:attribute>
                                    <xsl:attribute name="PromotionType">
                                    <xsl:value-of select="@PromotionType"/>
                                    </xsl:attribute>
                                    <xsl:copy-of select="Extn/."/>
                                </LineCharge>
                            </xsl:for-each>
                        </LineCharges>
                    </OrderLine>
                </xsl:for-each>
            </OrderDetail>
            <PaymentMethods>
                <xsl:copy-of select="PaymentMethods/PaymentMethod"/>
            </PaymentMethods>
        </OrderHeader>
    </xsl:template>
</xsl:stylesheet>
