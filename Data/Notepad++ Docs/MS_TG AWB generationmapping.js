%dw 2.0
output application/json
---
[{
  orderNo: payload.Container.Shipment.@ShipmentNo,
  awbNumber: payload.Container.Shipment.@ShipmentNo,
  shipmentOrderTypeCd: payload.Container.@ShipmentOrderTypeCd,
  shipmentOrderDt: payload.Container.Shipment.@Createts ++ "0Z",
  distributionCenter: payload.Container.@DistributionCenter,
  packageWeight: payload.Container.@ActualWeight,
  packageLength: payload.Container.@ContainerLength,
  packageBreadth: payload.Container.@ContainerWidth,
  packageHeight: payload.Container.@ContainerHeight,
  paymentType: payload.Container.Shipment.Extn.@ExtnPaymentType,
  packageValue: payload.Container.Shipment.Extn.@ExtnTotalNetAmount,
  partialDeliveryAllowedFl: payload.Container.@PartialDeliveryAllowed,
  cancellationAllowedFl: payload.Container.@CancellationAllowed,
  returnAllowedFl: payload.Container.@ReturnAllowed,
  deliverBranch: payload.Container.@deliverBranch,
  pickupBranch: payload.Container.@pickupBranch,
  pickupStartTimeWindow: payload.Container.Shipment.@PickUpStartTime ++ ".000Z",
  pickupEndTimeWindow: payload.Container.Shipment.@PickUpEndTime ++ ".000Z",
  pickupEmail: payload.Container.Shipment.FromAddress.@EMailID,
  pickupPhoneNumber: payload.Container.Shipment.FromAddress.@MobilePhone,
  pickupAccountCode: payload.Container.Shipment.@ShipNode,
  pickupAddressId: payload.Container.Shipment.FromAddress.@Company,
  pickupAccountName: payload.Container.Shipment.FromAddress.@FirstName,
  pickupApartment: payload.Container.Shipment.FromAddress.@AddressLine1,
  pickupStreetName: payload.Container.Shipment.FromAddress.@AddressLine3,
  pickupLocality: payload.Container.Shipment.FromAddress.@AddressLine2,
  pickupCity: payload.Container.Shipment.FromAddress.@City,
  pickupState: payload.Container.Shipment.FromAddress.@State,
  pickupCountry: payload.Container.Shipment.FromAddress.@Country,
  pickupPinCode: payload.Container.Shipment.FromAddress.@ZipCode,
  returnBranch: payload.Container.@DistributionCenter,
  returnStartTimeWindow: payload.Container.Shipment.@ReturnStartTime ++ ".000Z",
  returnEndTimeWindow: payload.Container.Shipment.@ReturnEndTime ++ ".000Z",
  returnAccountCode: payload.Container.Shipment.@ShipNode,
  returnAccountName: payload.Container.Shipment.FromAddress.@FirstName,
  returnEmail: payload.Container.Shipment.FromAddress.@EMailID,
  returnPhoneNumber: payload.Container.Shipment.FromAddress.@MobilePhone,
  returnApartment: payload.Container.Shipment.FromAddress.@AddressLine1,
  returnStreetName: payload.Container.Shipment.FromAddress.@AddressLine3,
  returnLocality: payload.Container.Shipment.FromAddress.@AddressLine2,
  returnCity: payload.Container.Shipment.FromAddress.@City,
  returnCountry: payload.Container.Shipment.FromAddress.@Country,
  deliverStartTimeWindow: payload.Container.Shipment.@ExpectedDeliveryDate ++ ".000Z",
  deliverEndTimeWindow: payload.Container.Shipment.@ExpectedDeliveryEndDate ++ ".000Z",
  deliverAccountCode: payload.Container.Shipment.ToAddress.@FullName,
  deliverAccountName: payload.Container.Shipment.ToAddress.@FullName,
  deliverEmail: payload.Container.Shipment.ToAddress.@EMailID,
  deliverPhoneNumber: payload.Container.Shipment.ToAddress.@MobilePhone,
  deliverAddressId: payload.Container.Shipment.ToAddress.@AddressID,
  deliverApartment: payload.Container.Shipment.ToAddress.@AddressLine1,
  deliverStreetName: payload.Container.Shipment.ToAddress.@AddressLine3,
  deliverLocality: payload.Container.Shipment.ToAddress.@AddressLine2,
  deliverCity: payload.Container.Shipment.ToAddress.@City,
  deliverState: payload.Container.Shipment.ToAddress.@State,
  deliverCountry: payload.Container.Shipment.ToAddress.@Country,
  deliverPinCode: payload.Container.Shipment.ToAddress.@ZipCode,
  clientCode: payload.Container.@clientCode,
  shipmentCrateMappings: payload.Container.Shipment.*ShipmentLines map ((shipment, index) -> {
    crateCd: shipment.ShipmentLine.@ShipmentLineNo,
    crateWeight: payload.Container.Shipment.Containers.Container.@ActualWeight,
    crateLength: payload.Container.Shipment.Containers.Container.@ContainerLength,
    crateBreadth: payload.Container.Shipment.Containers.Container.@ContainerWidth,
    crateHeight: payload.Container.Shipment.Containers.Container.@ContainerHeight,
    shipmentlineitems: shipment.*ShipmentLine map ((shipmentLine,shipmentLineindex) -> {
      itemCd: shipmentLine.@ItemID,
      itemName: shipmentLine.@ItemDesc,
      itemPrice: shipmentLine.OrderLine.ItemDetails.PrimaryInformation.@UnitCost,
      itemQuantity: shipmentLine.@Quantity
    })
  })
}]
 