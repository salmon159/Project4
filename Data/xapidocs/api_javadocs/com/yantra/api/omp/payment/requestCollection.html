<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0) on Wed Sep 28 16:02:42 UTC 2022 -->
<title>requestCollection (IBM Sterling Dev java docs)</title>
<meta name="date" content="2022-09-28">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="requestCollection (IBM Sterling Dev java docs)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div role="navigation" title ="TOP_Navigation" aria-label ="Top Navigation Bar"/>
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>IBM Sterling Selling And Fulfillment Foundation 10.0</b></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/yantra/api/omp/payment/recordExternalCharges.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/yantra/api/omp/payment/triggerRequestCollection.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/yantra/api/omp/payment/requestCollection.html" target="_top">Frames</a></li>
<li><a href="requestCollection.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div role="main" title ="requestCollection" aria-labelledby ="Header1"/>
<div class="header">
<div class="subTitle">com.yantra.api.omp.payment</div>
<h2 title="Interface requestCollection" class="title" id="Header1">Interface requestCollection</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Subinterfaces:</dt>
<dd>com.yantra.api.OMPApi, <a href="../../../../../com/yantra/interop/japi/YIFApi.html" title="interface in com.yantra.interop.japi">YIFApi</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">requestCollection</span></pre>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>org.w3c.dom.Document</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/yantra/api/omp/payment/requestCollection.html#requestCollection-com.yantra.yfs.japi.YFSEnvironment-org.w3c.dom.Document-">requestCollection</a></span>(<a href="../../../../../com/yantra/yfs/japi/YFSEnvironment.html" title="interface in com.yantra.yfs.japi">YFSEnvironment</a>&nbsp;env,
                 org.w3c.dom.Document&nbsp;inXML)</code>
<div class="block">The <code>requestCollection</code>() API processes an order for payment collection based on the order's payment rule and its payment methods.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="requestCollection-com.yantra.yfs.japi.YFSEnvironment-org.w3c.dom.Document-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>requestCollection</h4>
<pre>org.w3c.dom.Document&nbsp;requestCollection(<a href="../../../../../com/yantra/yfs/japi/YFSEnvironment.html" title="interface in com.yantra.yfs.japi">YFSEnvironment</a>&nbsp;env,
                                       org.w3c.dom.Document&nbsp;inXML)
                                throws com.yantra.yfs.japi.YFSException,
                                       java.rmi.RemoteException</pre>
<div class="block">The <code>requestCollection</code>() API processes an order for payment collection based on the order's payment rule and its payment methods.  An order can have multiple payment methods specified, which will be used to collect against.  For more information on payment methods for an order, please see the Product Concepts Guide.
<BR><BR>

If the order's payment rule specifies that authorization is required, then upon running this API, authorization requests will be created for the order, which will be processed by the <code>executeCollection</code>() API.  Once those authorization requests are processed by <code>executeCollection</code>(), running <code>requestCollection</code>() again will update the order's payment status based on the total order amount and the amount authorized for the order.  If the order's payment type specifies that authorizations should generate reversal requests when they are expired, then upon running this API, reverse authorization requests will be created for the expired authorizations that do not already have a charge request or a successful or pending reversal request.  The reverse authorization will be processed by the <code>executeCollection</code>() API.  In addition, if the payment rule specifies that excess authorizations should also be reversed, any authorization that is in excess of either the order total or a charge transaction request or invoice will have similar reversal requests created.
<BR><BR>

Similarly, if the order's payment rule specifies that settlement is required, then once the order's shipment has been invoiced, running this API will create charge requests, which will also be processed by <code>executeCollection</code>().  Once <code>executeCollection</code>() has processed the requests, running <code>requestCollection</code>() will update the order's payment status based on the total order amount and the amount collected for the order.
<BR><BR>

When the total order amount is reduced due to canceled quantities, price changes, returns, etc, invoking <code>requestCollection</code>() will issue refunds for the order if the collected amount is more than the new total order amount.  Based on the payment type configuration for the order's payment methods, various scenarios could arise in these refund scenarios - see the section on Issuing refunds below for more details.
<BR><BR><BR>
<b>Funds availability calculation</b>
<br>The API allocates funds against each payment method on the order. If a payment method has Unlimited Charges allowed then calculation is simple and requested amount is considered as available from this payment method. This API calls user exit <a href="../../../yfs/japi/ue/YFSGetFundsAvailableUE.html">com.yantra.yfs.japi.ue.YFSGetFundsAvailableUE</a><br/> to get the funds available on the payment if CHARGE_UP_TO_AVAILABLE = Y for the payment method and Unlimited charges are not allowed for the payment. API creates authorization/charge requests for the payment and computes request amount based on:
<b><br>For Authorization request: </b>It is minimum of following two
<br><LI><I>Funds available returned from user exit - pending charges - pending auths (pending = requests in OPEN status, yet to be processed by ExecuteCollection) </Li></I>
<br><LI><I>     Max charge limit - amount already used against payment (which also includes pending charges & auths) </LI></I>
<b><br><br>For Charge request</b>It is minimum of following two
<br><LI><I>     Funds available - pending charges </LI></I>
<br><LI><I>Max charge limit - amount already charged against payment (including pending)</LI></I>
Following table explains how the API calculates how much funds are available for a payment method for authorization or charging.
 <a name="xmltable"></a>
  <table BORDER="1" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
        <tr>
                <td COLSPAN=6 BGCOLOR="#EEEEFF"><font-family="Arial","Helvetica,san-serif" ><b>Example: How much funds are available when UnlimitedCharges is Y<b></font></td>
        <tr>
                <td> <a > Requested amount is considered as available</a></td>
        </tr>
 </table>
<br><br>
 <a name="xmltable"></a>
  <table BORDER="1" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
        <tr>
                <td COLSPAN=6 BGCOLOR="#EEEEFF"><font-family="Arial","Helvetica,san-serif" ><b>Example: How much funds are available when UnlimitedCharges is N and ChargeUptoAvailable is N<b></font></td>
        <tr>
                <td> <a >Requested Amount</a></td>
                <td><a >Max Charge Limit </a> </td>
                <td><a >Funds Available in Payment method</a></td>
                <td><a >Funds Available to Authorize/Charge</a></td>
        </tr>
        <tr>
                <td> <a >10</a></td>
                <td><a >100 </a> </td>
                <td><a >N/A</a></td>
                <td><a >10</a></td>
        </tr>
        <tr>
                <td> <a >1000</a></td>
                <td><a >100 </a> </td>
                <td><a >N/A</a></td>
                <td><a >100</a></td>
        </tr>
 </table>
<br><br>
 <a name="xmltable"></a>
  <table BORDER="1" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
        <tr>
                <td COLSPAN=6 BGCOLOR="#EEEEFF"><font-family="Arial","Helvetica,san-serif" ><b>Example: How much funds are available when UnlimitedCharges is N and ChargeUptoAvailable is Y<b></font></td>
        <tr>
                <td> <a >Requested Amount</a></td>
                <td><a >Max Charge Limit </a> </td>
                <td><a >Funds Available in Payment method</a></td>
                <td><a >Funds Available to Authorize/Charge</a></td>
        </tr>
        <tr>
                <td> <a >20</a></td>
                <td><a >100 </a> </td>
                <td><a >100</a></td>
                <td><a >20</a></td>
        </tr>
        <tr>
                <td> <a >20</a></td>
                <td><a >100 </a> </td>
                <td><a >10</a></td>
                <td><a >10</a></td>
        </tr>
        <tr>
                <td> <a >20</a></td>
                <td><a >10 </a> </td>
                <td><a >100</a></td>
                <td><a >10</a></td>
        </tr>
 </table>
<br><br><b>Handling of orders where customer accounts are maintained within system</b>
<br>These orders may go on hold when there are insufficient funds in the account. The hold is determined by the rule 'USE_HOLD_TYPE_CUSTOMER_ACCOUNT'. When orders on such holds get authorized, the hold is removed by this API.

<br><br><b>Dynamic Distribution</b>
<br>When the rule "Do Not Consolidate Debits Or Credits" is <code>N</code>, requestCollection will total any outstanding debits on the system and will attempt to charge the total using authorizations on the system.  If the rule is Y, then positive invoices will be considered separately for charging.  In order to support this functionality, authorizations and charges will be distributed dynamically to the order, invoices, and charge transaction requests.  This will be distributed in the following order:<ul>
<li>For all invoices, or charge transaction requests of the same sequence</li><ul>
<li>Find an charge that matches exactly the requested amount (prefer the earliest charge sequence payment method on ties)</li>
<li>Use the largest charge remaining for each payment method, in sequence</li>
<li>Handle negative invoices, if required</li>
<li>For each group of payment methods of the same sequence, in sequence</li><ul>
<li>First, look for an authorization that matches exactly the requested amount</li>
<li>Handle mismatched authorization/request amounts</li><ul>
<li>Use the smallest authorization larger than the required amount, or the largest if none are larger</li>
<li>If the remainder cannot be reused based on payment configuration, mark it as unusable.</li>
</ul></ul></ul>
<li>The following will be ignored from mapping, as they are either complete or invalid</li><ul>
<li>Fully distributed invoices and credits</li>
<li>Voided invoices</li>
<li>Expired authorizations</li>
<li>Reversed authorizations or authorizations pending reversal</li>
<li>Authorizations with a pending settlement (for the full remaining authorization amount)</li>
</ul></ul>


<br><br><B>Charge Consolidation</B> - When charge requests are created for the order, they will be considered for charge consolidation if the criteria below are met:
<li>the payment type on the charge request has charge consolidation enabled</li>
<li>the charge is created from an authorization request (i.e. the charge has an <code>AuthorizationID</code>)</li>
<li>the charge amount is not for the full amount of the authorization request's authorized amount</li><BR>
<BR>
<UL>
<i>How charge consolidation works:</i>
        <UL>
                <li>When an authorization request, A1, is processed by <code>executeCollection</code>, its <code>ExecutionDate</code> field is set to the date and time of when it was processed.</li>
                <li>When a charge, C1, is created by <code>requestCollection</code> to settle against A1 and meets the criteria mentioned above for consolidation, its <code>CollectionDate</code> is stamped as A1's <code>ExecutionDate</code>, offset by the consolidation window configured for C1's payment type</li>
                <li>This <code>CollectionDate</code> on C1 prevents the <code>executeCollection</code> agent from processing it until the specified date. Until then, further amounts ready to be settled against A1 can be consolidated to C1.
        </UL>
        <BR/>
        A charge request held for consolidation will be processed by <code>executeCollection</code> when its <code>CollectionDate</code> has passed. There are 2 scenarios, listed below, in which the <code>CollectionDate</code> is reset to the current date and time in order to expedite collection.
        <ul>
                <li>
                        The requested charge amount on C1 matches the authorized amount for A1, i.e. no further consolidation can occur
                </li>
                <li>
                        The order is complete, i.e. no book amount left that would require a charge
                </li>
        </ul>
        This is so that <code>executeCollection</code> can settle the charge sooner since there are no further amounts that can be consolidated to it.  A charge request can also have a <code>CollectionDate</code> in the future because it was already processed by <code>excuteCollection</code>, failed and the output from the user exit specified that it should be retried again at a later time.  In these scenarios, the system will not reset the <code>CollectionDate</code>.
</UL>
<BR><BR>


<B>Issuing refunds</B> - When refunds are being issued, they will attempt to be issued in the order below.
<BR><BR>
<UL>
<I>Refunding charges</I><BR>
For charges where <code>HoldAgainstBook</code> is not <code>Y</code>, a refund will be issued based on the payment's refund rules, if it is valid for refund (more on refund rules below).  Refunds will first be issued to the payments with the highest refund sequence priority, then lowest charge sequence priority.
<BR><BR>

<I>Refunding charges held against book</I><BR>
For charges where <code>HoldAgainstBook = Y</code>, a refund will be issued based on the payment's refund rules, if it is valid for refund.  Refunds will first be issued to the payments with the highest refund sequence priority, then lowest charge sequence priority.  Charges with <code>HoldAgainstBook = Y</code> are typically created for precharges, charges that occurred before the order was entered in the system, or payment types with <code>ChargeInsteadOfAuth = Y</code>.
<BR><BR>

<I>Refunding more than the charged amount</I><BR>
If the amount to be refunded has not been fully distributed after the two passes above, there will be a check against the system rule, Exceed Charge Amount For Refund, for the Document Type / Enterprise combo.  If this rule is enabled, then the remaining amount will be refunded to the payment with the highest refund sequence priority / lowest charge sequence priority that is valid for refund.
<BR><BR>

<I>Refunding Funds Transferred In</I><BR>
If the order is a Refund Fulfillment Order, or an Exchange Order where the originating Return order has been invoiced, it would have <code>TRANSFER_IN</code> credit(s).  If the order amount is reduced, the transferred credits may no longer be needed.  The amount not needed would then be transferred back to the order from which it originated through the creation of a <code>TRANSFER_OUT</code> charge transaction record for the order being refunded, and a <code>TRANSFER_IN</code> record would be created for the order from which the credit originated.
<BR><BR>

<I>Default Refund Payment Type</I><BR>
If after all of the steps outlined above, there still remains some amount that needs to be refunded, a refund will be issued using the seller organization's default payment type for refund, if it is specified.  This method of issuing a refund, along with the methods above, with the exception of returning transferred credits, will be issued based on the payment type's refund rules.
<BR><BR>

Note: A payment is valid for return if it is not suspended for refunds, has valid payment information based on the payment type group, and its payment type is valid for return.  The payment information required for a payment type group is specified below:
        <UL>
                <LI>Credit Card - <code>CreditCardNo</code>
                <LI>Customer Account - <code>CustomerAccount</code>
                <LI>Other - <code>PaymentReference1</code>
                <LI>Stored Value Card - <code>SvcNo</code>
        </UL>
</UL>
<BR><BR>

<B>Payment Type Refund Rules</B> - This explains in detail how a payment type's refund rules are applied when issuing refunds.
<BR><BR>
<UL>
        <I>Refund Same Account</I><BR>
        If enabled, when issuing a refund to a payment that was charged, i.e. a payment that was used to pay for the order, a refund charge (<code>ChargeType = CHARGE</code>, <code>RequestAmount</code> = negative refund amount) will be created against the payment.
        <BR><BR>

        <I>New Refund Payment Type</I><BR>
        If the Refund Same Account flag is disabled, then this attribute must be set.  When refunds are issued to a payment whose payment type has this attribute set, the refund will be issued based on the refund rules for the selected New Refund Payment Type.  For example, payment type "Check" has New Refund Payment Type = "SVC".  When a refund is issued to a payment of payment type "Check", it will be carried out based on the "When Refunding To A New Payment" refund rules for SVC.
        <BR><BR>

        <B>When Refunding To A New Payment</B> - When not refunding to the same payment account, the settings below apply.
        <BR><BR>
        <I>Apply Alternate Refund Payment Type Constraint</I><BR>
        If this option is selected, a comparison type (greater than / less than), a comparison value (dollar amount) and Alternate Refund Payment Type must all be specified.  If the refund amount satisfies the constraint created by the comparison type and value, the refund will be issued based on the refund rules for the
        Alternate Refund Payment Type.  For example, payment type "SVC" has this setting turned on with comparison operator and value set to Less Than 5, with a Alternate Refund Payment Type = "Check".  If the refund amount being issued to a new SVC is less than 5, then that refund will be issued based on the "When Refunding To A New Payment" rules for payment type "Check".
        <BR><BR>

        In addition to the rule above, one of the following 3 options must be selected:<BR>
        <UL>
                <LI><I>Refund using Fulfillment Order</I><BR>
                If this option is selected, a fulfillment item ID and UOM must be selected.  A Refund Fulfillment order and order line with specified item ID / UOM will be created and the unit price of the order line will be set to the refund amount.  The funds collected against the original order will be transferred to the refund fulfillment order - a <code>TRANSFER_OUT</code> charge transaction will be created for the original order, with credit amount = negative refund amount and a <code>TRANSFER_IN</code> charge transaction will be created for the refund fulfillment order with credit amount = refund amount.
                <BR>

                <LI><I>Refund and await payment info</I><BR>
                If this option is selected, a new payment record will be created for the order using this payment type.  The Incomplete Payment Info event will also be raised, if it is enabled.  The order will then be unpickable by the <code>RequestCollection</code> agent and will await manual intervention, at which time a credit memo could be made for the refund amount and the remaining steps depend on the implementation as dictated by the business requirements.
                <BR>

                <LI><I>Refund and create charge</I><BR>
                If this option is selected, a new payment record will be created for the order using this payment type and a refund charge (<code>ChargeType = CHARGE</code>, <code>RequestAmount</code> = negative refund amount) will be created against the payment.  This payment will not have valid payment information, but the relevant payment information can be set through the Payment detail screen or the <code>executeCollection</code> or <code>recordCollection</code> APIs.  Please refer to those javadocs on how to set the payment information.
        </UL>
</UL>
<BR><BR>

<B>Delayed Reauthorization</B> - When the Payment Rule on the order supports delayed reauthorization, request collection reforms additional actions and checks.
<BR><BR>
<UL>
        <I>Amount Calculation for Authorization by Date.</I><BR>
        <UL>
        <LI>When delaying reauthorization, the order may release at different times.  Only the amount of the order that is releasing will be authorized.</LI>
        <LI>Charges and taxes will be calculated using the pack list pricing logic for each expected release date.  User Exits will be called if implemented, however, no release key will be passed to the User Exit as there is no existing release in the system.</LI>
</UL>
        <I>Payment Rule: Authorize Before Schedule, Delay Reauthorization Until Release</I><BR>
<UL>
        <LI>If there is a positive price change on the order, the full order amount that is not covered by currently active authorizations will have new authorization requests created for it.</LI>
         <LI>When the order is fully authorized and scheduled, the dates for
         reauthorization will be recomputed. Until the order is scheduled, new
         authorizations will be acquired upon expiration.</LI>
         <LI>When the reauthorization date approaches, an authorization request
         for the amount needed for that date will be created.</LI>
         <LI>Reauthorization will occur based on the expected dates on each line.
         Lines with separate expected dates will be authorized separately; lines
         with the same expected date will be authorized for the total.</LI>
</UL>
        <I>Payment Rule: Authorize Before Release</I><BR>
<UL>
        <LI>When the reauthorization date approaches, an Authorization request for the amount needed for that date will be created.</LI>
        <LI>The payment status of the order will be <code>AWAIT_AUTH</code> until an authorization is acquired, at which point, the order will be <code>AUTHORIZED</code>.</LI>
</UL>
</UL>
<BR><BR>

<b>Charge Transaction Requests</b> - When the Payment Rule on the order
supports Charge Transaction Requests for Authorization:<br>
<ul>
<li><code>requestCollection</code> will not create any authorization
requests until Charge Transaction Requests have been added to the order
by the <code>manageChargeTransactionRequest</code> API.</li>
<li>Authorization requests created by iterating over the Charge
Transaction Requests and creating and mapping authorizations to each
request, up to the maximum allowed for that request. Total Authorization
amount will not exceed the order's book amount, even if the total maximum
allowed for the requests is greater than the order's total.</li>
<li>Before creating any new authorization requests, existing
authorizations and charges that have not been mapped to a charge
transaction request will be mapped to open charge transaction requests.
The mapping will use the sequence of the charge transaction requests. If
the unmapped record amount is greater than the highest priority request
the remainder will be mapped to the next request.</li>
<li>requestCollection will not attempt to map the remainder of a mapped
Charge Transaction record in excess of the request that it is mapped to.</li>
<li>The payment status of the order will be set to
<code>AUTHORIZED</code> when there are no Charge Transaction Requests on
the order. Otherwise, the Payment Status on the order will be set with
the following priority:
<ol>
<li>Payment Processing Failure and not enough payment methods</li>
<li>The lowest priority status of the Charge Transaction Requests, if at
least one is not in <code>AUTHORIZED</code> status. PaymentStatus
priority for Charge Transaction Requests is defined as
<code>FAILED_AUTH</code>, <code>AWAIT_AUTH</code>,
<code>REQEUSTED_AUTH</code>, <code>AUTHORIZED</code></li>
<li>Normal payment status logic.</li>
</ol>
</li>
<li>Charge Transaction Requests are not supported when the payment rule
requires settlement. <code>ChargeInsteadOfAuthorize</code> payment types
are supported.</li>
</ul>
<br>
<BR>

<B>Exchange orders</B> - When invoking this API for Exchange Orders, the behavior will depend on the exchange order type.
<BR><BR>
<UL>
        <I>Regular</I><BR>
        The order will not be processed if it has a pending transfer in amount.  Only when the pending transfer in amount has completely transferred or canceled will this order be processed for payment collection.
        <BR><BR>

        <I>Advanced</I><BR>
        If the order has a pending transfer in amount, that amount is considered to be as good as collected.  Thus, if the order amount is less than or equal to the pending transfer in amount, the payment status will be move to Authorized.  But if the order amount is greater than the pending transfer in, then payment info and authorization will be required for the discrepant amount before the payment status can move to Authorized.
        <BR><BR>

        <I>Advanced Pre-paid</I><BR>
        This type of exchange order will be processed as a normal sales order, regardless of the pending transfer in amount.  When funds are transferred into this exchange order, <code>requestCollection()</code> will be triggered to issue refunds for the payments on this order.
        <BR><BR>

        Note: Please refer to the javadoc for the <code>createOrderInvoice</code> API on how funds are transferred to the exchange order.

</UL>
<BR><BR>

<b>Partial Reversal of Authorizations</b> - When the <code>Partial Reversal Supported
</code> rule is enabled for a Payment Type on the order:<br>
<ul>
<li><code>requestCollection</code> will compute the unusable amount of each existing 
authorization in the system. This includes excess during dynamic mapping, 
as well as general excess of an over authorization of the order total. </li>
<li>During excess reversal creation, the API will generate reversals for partial authorization
value, if applicable.  When creating reversals for expired authorizations, previously
reversed amounts will be considered.</li>
</ul>
<br>
<BR>

 This is a hold type enabled transaction. If order has a hold type which has <code>PAYMENT_COLLECTION</code> as
 one of the prevented transactions then this transaction can not process the order. Error <i>OMP11037: Transaction is prevented when order is on hold type </i> is thrown.
 <BR><BR>
  <!--- TABLE START --->
  <a name="xmltable"></a>
  <table BORDER="1" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
        <tr>
                <td COLSPAN=6 BGCOLOR="#EEEEFF"><font-family="Arial","Helvetica,san-serif" ><b>Related Documents<b></font></td>
        <tr>
                <td> <a href="../../../../../XSD/HTML/YFS_requestCollection_input.html"> Input XML</a></td>
                <td><a href="../../../../../dtd/YFS_requestCollection_input_dtd.txt">Input DTD </a> </td>
                <td><a href="../../../../../XSD/HTML/YFS_requestCollection_output.html">Output XML</td>
                <td><a href="../../../../../dtd/YFS_requestCollection_output_dtd.txt">Output DTD</td>
                <td><a href="../../../../../XSD/HTML/YFSError.html">Error XML</a></td>
                <td><a href="../../../../../dtd/YFSError_dtd.txt">Error DTD</a></td>
        </tr>
 </table>
 <!-- TABLE END -->
<p> <b>User Exits:</B>
 <ul><a href="../../../yfs/japi/ue/YFSGetFundsAvailableUE.html">com.yantra.yfs.japi.ue.YFSGetFundsAvailableUE</a><br/>
 <ul>This user exit is called for each payment method whose payment type has <code>ChargeUpToAvailable</code> flag set to <code>Y</code>.  It determines the funds available on the payment method to be charged.
 </ul></ul>
 <ul><a href="../../../yfs/japi/ue/OMPConfirmRefundDistributionUE.html">com.yantra.yfs.japi.ue.OMPConfirmRefundDistributionUE</a><br/>
 <ul>This user exit is called for each charge transaction processed. It confirms the refund distribution to new and existing payment methods.
 </ul></ul>
<p> <b>Events Raised:</B>
<br><ul><code>PAYMENT_COLLECTION.INCOMPLETE_PAYMENT_INFORMATION</code>: This event is raised if the payment methods of the order are insufficient ( because of issues such as incompleteness or MaxChargeLimit) to cover the required funds. For more information, see the associated
<a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.INCOMPLETE_PAYMENT_INFORMATION.html">XML</a>,
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.INCOMPLETE_PAYMENT_INFORMATION_dtd.txt"> DTD</a> and
<a href="../../../../../dbd/modifyOrder_dbd.txt">Key data</a> files.
<ul><p><b>Template Support:</b>
<br>Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.

</ul><p><code>PAYMENT_COLLECTION.PAYMENT_STATUS</code>:  This event is raised if the <code>requestCollection</code> API changes the <code>PaymentStatus</code> of the <code>Order</code>. For more information, see the associated
<a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.PAYMENT_STATUS.html">XML</a>,
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.PAYMENT_STATUS_dtd.txt"> DTD</a> and
<a href="../../../../../dbd/modifyOrder_dbd.txt">Key data</a> files.
<p><ul><b>Template Support:</b>
<br>Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.

</ul><p><code>PAYMENT_COLLECTION.REQUEST_PAYMENT_STATUS</code>: This event is raised if the <code>requestCollection</code> API changes the
<code>PaymentStatus</code> of a <code>ChargeTransactionReqeust</code>. For more information, see the associated <a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.REQUEST_PAYMENT_STATUS.html">XML</a> and
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.REQUEST_PAYMENT_STATUS_dtd.txt"> DTD</a> files. This event is raised once per request.
<p><ul><b>Template Support:</b>
<br> Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.

</ul><p><code>PAYMENT_COLLECTION.ON_LIABILITY_TRANSFER</code>:  This event is raised if the <code>requestCollection</code> API creates a Charge Transaction Distribution record. Such records are created when pre-collected charges are being refunded instead of being used to collect against an invoice.  That is, when an order with pre-collected charges gets reduced in price or canceled.  For more information, see the associated
<a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.ON_LIABILITY_TRANSFER.html">XML</a>,
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.ON_LIABILITY_TRANSFER_dtd.txt"> DTD</a> and
<a href="../../../../../dbd/modifyOrder_dbd.txt">Key data</a> files.
<p><ul><b>Template Support:</b>
<br>Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.

</ul><p><code>PAYMENT_COLLECTION.ON_RFO_CREATION</code>:  This event is raised if the <code>requestCollection</code> API creates a Refund Fulfillment Order. Such records are created when there are refunds on an order and payment type is configured to Return with creation of Return Fulfillment Order. For more information, see the associated
<a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.ON_RFO_CREATION.html">XML</a>,
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.ON_RFO_CREATION_dtd.txt"> DTD</a> and
<a href="../../../../../dbd/modifyOrder_dbd.txt">Key data</a> files.
<p><ul><b>Template Support:</b>
<br>Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.

</ul><p><code>CREATE_ORDER_INVOICE.ON_INVOICE_COLLECTION</code>:  This event is raised when the API creates an Invoice Collection record. Such records are created when charges are applied to an invoice.  Normally this will only occur when the <code>requestCollection</code> API is run.  However whenever an invoice is created if there are charges which can be distributed to that invoice they will be.   For more information, see the associated
<a href="../../../../../XSD/HTML/YFS_PAYMENT_COLLECTION.ON_INVOICE_COLLECTION.html">XML</a>,
<a href="../../../../../dtd/YFS_PAYMENT_COLLECTION.ON_INVOICE_COLLECTION_dtd.txt"> DTD</a> and
<a href="../../../../../dbd/order_dbd.txt">Key data</a> files.
<p><ul><b>Template Support:</b>
<br>Yes. Some of the elements and attributes are not template driven. Refer to the xml for element level details.
 </ul><p><code>ORDER_CHANGE.ON_HOLD_TYPE_STATUS_CHANGE</code>: This event is raised for each hold type of which status has been changed. This may happen when order had a hold due to insufficient funds in customer account and now hold is getting resolved by the transaction.
        <br>Data published - <a href="../../../../../XSD/HTML/YFS_ON_HOLD_TYPE_STATUS_CHANGE.html">YFS_ON_HOLD_TYPE_STATUS_CHANGE.xml</a>
        <br>Key data - <a href="../../../../../dbd/modifyOrder_dbd.txt">modifyOrder_dbd.txt</a>
<p><ul><b>Template Support:</b>
<br>Yes.
</ul>
</p>
         </ul>
         </ul>
<p> <b>Audits:</B> None
<p> <b>Pre-conditions:</B> None
<p> <b>Post-conditions:</B> None
<p> <b>Output Template Support:</B>  Yes
<br>
<p> <b>Database Extensibility Support:</B>  Yes
<br>
<br></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>env</code> - Required. Environment handle returned by the <code>createEnvironment</code> API.</dd>
<dd><code>inXML</code> - Required. For more information, see the associated <a href="#xmltable">input xml files</a>.

<p></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>An xml document containing the details of the processed Order. For details on the output, refer to the associated
 <a href="#xmltable">output files</a>.
<br>
<br></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><b>YFSException</b></code> - Exception containing error codes in the standard  <a href="#xmltable">error files</a>.</dd>
<dd><code><b>RemoteException</b></code> - Java's default remote exception handler.</dd>
<dd><code>com.yantra.yfs.japi.YFSException</code></dd>
<dd><code>java.rmi.RemoteException</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div role="navigation" title ="Bottom_NAVIGATION" aria-label ="Bottom Navigation Bar"/>
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>IBM Corp. Confidential</b></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/yantra/api/omp/payment/recordExternalCharges.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/yantra/api/omp/payment/triggerRequestCollection.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/yantra/api/omp/payment/requestCollection.html" target="_top">Frames</a></li>
<li><a href="requestCollection.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<div role="contentinfo" title ="contentinfo_title" aria-label ="Contains footer note"/>
<p class="legalCopy"><small><font face='Verdana' size='1'>&#169; Copyright IBM Corp. 2001, 2013 All Rights Reserved. </font></small></p>
</body>
</html>
