<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0) on Wed Sep 28 16:02:42 UTC 2022 -->
<title>executeCollection (IBM Sterling Dev java docs)</title>
<meta name="date" content="2022-09-28">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="executeCollection (IBM Sterling Dev java docs)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div role="navigation" title ="TOP_Navigation" aria-label ="Top Navigation Bar"/>
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>IBM Sterling Selling And Fulfillment Foundation 10.0</b></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/yantra/api/omp/payment/computeRefundPayments.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/yantra/api/omp/payment/executePaymentTransactions.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/yantra/api/omp/payment/executeCollection.html" target="_top">Frames</a></li>
<li><a href="executeCollection.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div role="main" title ="executeCollection" aria-labelledby ="Header1"/>
<div class="header">
<div class="subTitle">com.yantra.api.omp.payment</div>
<h2 title="Interface executeCollection" class="title" id="Header1">Interface executeCollection</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Subinterfaces:</dt>
<dd>com.yantra.api.OMPApi, <a href="../../../../../com/yantra/interop/japi/YIFApi.html" title="interface in com.yantra.interop.japi">YIFApi</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">executeCollection</span></pre>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>org.w3c.dom.Document</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/yantra/api/omp/payment/executeCollection.html#executeCollection-com.yantra.yfs.japi.YFSEnvironment-org.w3c.dom.Document-">executeCollection</a></span>(<a href="../../../../../com/yantra/yfs/japi/YFSEnvironment.html" title="interface in com.yantra.yfs.japi">YFSEnvironment</a>&nbsp;env,
                 org.w3c.dom.Document&nbsp;inXML)</code>
<div class="block">The executeCollection API processes authorization and charge requests that are in <code>OPEN</code> status.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="executeCollection-com.yantra.yfs.japi.YFSEnvironment-org.w3c.dom.Document-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>executeCollection</h4>
<pre>org.w3c.dom.Document&nbsp;executeCollection(<a href="../../../../../com/yantra/yfs/japi/YFSEnvironment.html" title="interface in com.yantra.yfs.japi">YFSEnvironment</a>&nbsp;env,
                                       org.w3c.dom.Document&nbsp;inXML)
                                throws com.yantra.yfs.japi.YFSException,
                                       java.rmi.RemoteException</pre>
<div class="block">The executeCollection API processes authorization and charge requests that are in <code>OPEN</code> status.  It can process either a single request or all of the requests for an entire order.  If the <code>ChargeTransactionKey</code> is passed in the input, then only that request will be processed.  However if it is not, and only <code>OrderHeaderKey</code> is passed, then all of the requests in <code>OPEN</code> status for that order will be processed.  In this scenario, <code>AUTHORIZATION</code> requests will be processed before the <code>CHARGE</code> requests.  And within those two groups, the request records with the earliest create time stamp are processed first.
 <BR><BR>
 The ExecuteCollection agent (yfs.agent.executecollection) picks up individual <code>AUTHORIZATION</code> and <code>CHARGE</code> request records for an order and invokes the executeCollection() API for each request by passing the <code>ChargeTransactionKey</code>.  These records will also be picked up based on their time of creation.  To re-prioritize the sequence in which these requests are processed, implement a custom agent with a different sorting critera to achieve the desired priority.  Then invoke the executeCollection() API for each individual request.

<br><br><b>Handling of orders where customer accounts are maintained within system</b>

<br><b>AUTHORIZATION: </b> The user exit  <code>YFSCollectionCustomerAccountUE</code> is not called for AUTHORIZATION requests. API checks how much funds are available in the customer account. If requested amount is  less than or equal to the AvailableAccountBalance, then  the  AUTHORIZATION request is closed and  Open Authorization amount against that customer account is increased . If requested amount is unavailable then  the  hold configured by  the  rule 'USE_HOLD_TYPE_CUSTOMER_ACCOUNT' is applied on order.  The requested amount is added back to customer account for negative authorization requests. 

<br><b>CHARGE: </b> The user exit  <code>YFSCollectionCustomerAccountUE</code>  is called for CHARGE requests.  The processed amount returned by  the  user exit is settled and becomes available to customer account  if it returns synchronously.  For asynchronous implementations, <code>recordExternalCharges</code> should be called

 <BR><BR>
 This is a hold type enabled transaction. If order has a hold type which has <code>PAYMENT_EXECUTION</code> as one of the prevented transactions then this transaction can not process the order. Error <i>OMP11037: Transaction is prevented when order is on hold type </i> is thrown.
<br><br><I>Note: This API cannot be used with requestCollection API - either through events, multiApi calls or services.</I>
<br>
<p>
 <B> No processing payment methods</B>
 <p> These payment methods are payment methods that are identified by the NoProcessingRequired configuration, and are typically payments like cash. These payment methods will be automatically processed without invoking the collection user exits.

<p>
<br>
<p>
 <B> Business Validation</B>
 <p> Business Validation framework is invoked when an OFFLINE charge transaction is being processed . Please refer to <a href="capturePayment.html" title="capturePayment API">capturePayment</a> for more details.

<p>
 <p>
 <b>No processing payment methods</b>
 </p>
 <p>
 These payment methods are payment methods that are identified by the <code>NoProcessingRequired</code> configuration, and are typically payments like
 cash. These payment methods will be automatically processed without invoking the collection user exits.
 </p>
 <BR><BR>
 <!--- TABLE START --->
  <a name="xmltable"></a>
  <table BORDER="1" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">        
        <tr>
                <td COLSPAN=6 BGCOLOR="#EEEEFF"><font-family="Arial","Helvetica,san-serif" ><b>Related Documents<b></font></td>
        <tr>
                <td> <a href="../../../../../XSD/HTML/YFS_executeCollection_input.html"> Input XML</a></td>
                <td><a href="../../../../../dtd/YFS_executeCollection_input_dtd.txt">Input DTD </a> </td>
                <td><a href="../../../../../XSD/HTML/YFS_executeCollection_output.html">Output XML</td>
                <td><a href="../../../../../dtd/YFS_executeCollection_output_dtd.txt">Output DTD</td>
                <td><a href="../../../../../XSD/HTML/YFSError.html">Error XML</a></td>
                <td><a href="../../../../../dtd/YFSError_dtd.txt">Error DTD</a></td>
        </tr>
 </table>
 <!-- TABLE END -->
<br>
<p> <B>User Exits:</B><br>
 The <code>executeCollection</code> API invokes one of the following user exits for each payment method on the order based on the <code>PaymentTypeGroup</code> attribute of the payment method. 
 Certain key attributes from the output of these user exits are made available as a part of the output XML for this API.
<p>
<ul>
 <a href="../../../yfs/japi/ue/YFSCollectionCreditCardUE.html">com.yantra.yfs.japi.ue.YFSCollectionCreditCardUE</a><br>
 <a href="../../../yfs/japi/ue/YFSCollectionCustomerAccountUE.html">com.yantra.yfs.japi.ue.YFSCollectionCustomerAccountUE</a><br>
 <a href="../../../yfs/japi/ue/YFSCollectionOthersUE.html">com.yantra.yfs.japi.ue.YFSCollectionOthersUE</a><br>
 <a href="../../../yfs/japi/ue/YFSCollectionStoredValueCardUE.html">com.yantra.yfs.japi.ue.YFSCollectionStoredValueCardUE</a><br>
 <a href="../../../yfs/japi/ue/YFSCollectionDebitCardUE.html">com.yantra.yfs.japi.ue.YFSCollectionDebitCardUE</a><br>

</ul>
<br>
<br> The User Exits must be implemented. If the UserExit corresponding to the <code>PaymentType</code> of the <code>YFS_CHARGE_TRANSACTION</code> record is not found, the following error thrown 
         <br><i>YFS10497</i> - <i>UserExit not found.</i>
 <br>
 The following user exit will be called in certain scenarios before calling the collection user exits 
 mentioned above to find out whether the earlier collection request was successfull. 
 Please refer to the user exit documentation for more information.  
 <a href="../../../yfs/japi/ue/YFSValidateInvokedCollectionUE.html">com.yantra.yfs.japi.ue.YFSValidateInvokedCollectionUE</a>
<br>
<p><B>Events Raised:</B><br>
<ul>
<p><code>ON_HOLD_TYPE_STATUS_CHANGE</code> event for the <code>PAYMENT_EXCUTION</code> transaction.
<ul>This event is raised for each hold type of which status has been changed.
<br>Data published - <a href="../../../../../XSD/HTML/YFS_ON_HOLD_TYPE_STATUS_CHANGE.html">YFS_ON_HOLD_TYPE_STATUS_CHANGE.xml</a>
<br>Key data - <a href="../../../../../dbd/modifyOrder_dbd.txt">modifyOrder_dbd.txt</a> 
<br><b>Template Support:</b> Yes. </ul></p>
<code>CHARGE_FAILED</code> event for the <code>PAYMENT_EXCUTION</code> transaction. 
<ul><br>This event is <i>deprecated</i> as of 5.0 SP1. Use the <code>CHARGE_FAILED_XML</code> event instead of this event.
<br> Keydata published can be found in the <a href="../../../../../dbd/modifyOrder_dbd.txt">modifyOrder_dbd.txt</a> file.     
<br>Data Published can be found in the <a href="../../../../../dbd/PAYMENT_EXECUTION_CHARGE_FAILED_dbd.txt">PAYMENT_EXECUTION_CHARGE_FAILED_dbd.txt</a> file.
<p><b>Template Support:</b> No
</ul>
 <p>
 <code>CHARGE_FAILED_XML</code> event for the <code>PAYMENT_EXCUTION</code> transaction. 
 <br><ul> Keydata published can be found in the <a href="../../../../../dbd/modifyOrder_dbd.txt">modifyOrder_dbd.txt</a> file.
 <br> DataPublished can be found in the <a href="../../../../../XSD/HTML/YFS_PAYMENT_EXECUTION.CHARGE_FAILED_XML.html">XML</a> and 
<a href="../../../../../dtd/YFS_PAYMENT_EXECUTION.CHARGE_FAILED_XML_dtd.txt"> DTD</a> files
<p><b>Template Support:</b>
 Yes. Some elements and attributes are not template driven. Refer to xml for element level details.
         </ul>
<p> The <code>PAYMENT_EXECUTION.CHARGED_FAILED</code> and/ or <code>PAYMENT_EXECUTION.CHARGE_FAILED_XML</code> event are raised when 
 <br><ul> <code>YFSExtnPaymentCollectionOutputStruct.authorizationAmount</code> is not equal to 
 <code>YFSExtnPaymentCollectionInputStruct.requestAmount</code> 
 <ul>and </ul>
 <code>YFSExtnPaymentCollectionOutputStruct.retryFlag</code> is <b><code>N</code></b>
 <ul>and </ul>
 <code>YFSExtnPaymentCollectionOutputStruct.holdOrderAndRaiseEvent</code> is <b><code>True</code></b>.</ul>
 <p> The <code>PaymentStatus</code> is set based on the <code>ChargeType</code>:
 <br><ul>If the <code>ChargeType</code> is <b><code>AUTHORIZATION</code></b>, <code>PaymentStatus</code> is set to <b><code>FAILED_AUTH</code></b>
 <br>If the ChargeType if <b><code>CHARGE</code></b>, <code>PaymentStatus</code> is set to <b><code>FAILED_CHARGE</code></b></ul>
 <p>     Refer to the documentation of the  User Exits for information on <code>YFSExtnPaymentCollectionInputStruct</code> and <code>YFSExtnPaymentCollectionOutputStruct</code>.
<p> If the order <code>PaymentStatus</code> is set  to <b><code>FAILED_AUTH</code></b> or <b><code>FAILED_CHARGE</code></b>, manual intervention is required to resolve the issue. Possible resolutions can be adding a new payment method to the order, changing the <code>MaxChargeLimit</code> of existing payment methods, or changing the <code>ChargeSequence</code> of existing payment methods.
<p> If the order <code>PaymentStatus</code> is set  to <b><code>FAILED_AUTH</code></b> or <b><code>FAILED_CHARGE</code></b>,  and <code>YFSExtnPaymentCollectionOutputStruct.suspendPayment</code> is <b><code>Y</code></b> (to suspend it only for charge) or to <b><code>B</code></b> (to suspend it for both charge and refund),  the payment method associated with the charge transaction record is suspended and the <code>AuthorizationExpirationDate</code> on the order header is set to current date. If the <code>executeCollection</code> API is called by passing a nonvoid value of <code>ChargeTransactionKey</code> in the input XML, then all the other open charge transaction records of the suspended payment method are closed. If  the <code>executeCollection</code> API is called for an order,   all the charge transaction records of the suspended payment method which are open at that time, are processed by the <code>executeCollection</code> API.
         
<p> If the order  <code>PaymentStatus</code> is set  to <b><code>FAILED_AUTH</code></b> or <b><code>FAILED_CHARGE</code></b>, and <code>YFSExtnPaymentCollectionOutputStruct.suspendPayment</code> is not equal to <b><code>Y</code></b>, then the <code>AuthorizationExpirationDate</code> on the order header is set to a high date. This means the order is not picked up by <code>requestCollection</code> unless some change is made, like addition of new payment method, or changing the <code>MaxChargeLimit</code> of existing payment methods,  which resets the <code>AuthorizationExpirationDate</code> on the order header to the current date.
</ul>
<p> <B>Audits:</B>  None
 <p><B>Pre-conditions:</B>
<br> If the <code>PaymentStatus</code> of the Order is <b><code>HOLD</code></b>, the following error is thrown : 
<br> <i>YFS10290 - YFS: Order can not be processed. </i>
<br>
<p> <B>Post-conditions:</B><br>  None
<p> <B>Output Template Support:</B> No
 <p><B>Database Extensibility Support:</B> No
 <p><B>Additional Information:</B>
<ul>
 <p>The user exit called by the <code>executeCollection</code> API must handle the settlement request.
 <p>The user exit can carry out the settlement immediately by interfacing to an external source, or an accounts receivable database, 
 and pass back the settlement amount. If the settlement is
 received for an amount less than the requested amount, the
 order's payment status is changed to <b><code>FAILED_CHARGE</code></b>.
 <p>The user exit can also place a request to try again later if the interface to the payment
 system is inoperable.
 <p>Multiple requests may be made to the payment gateway inside the collection user exit in some scenarios, 
 such as obtaining an authorization before a charge if there was not one.  The <code>recordAdditionalTransactions</code> 
 output struct field may be used to return additional information to be stored in the system; however, if you update the authorizationId for a <code>CHARGE</code> request during reauthorization, then you must return any reversal and reauthorization information with recordAdditionalTransactions.  
 Note that any record returned will adjust the authorization or charge total on the payment method. 
 <p>Finally, the user exit can request asynchronous processing, meaning that the Sterling Supply Chain Applications never
 contact the payment system for this order. When the user exit returns with <code>asyncRequestProcess=true</code>, the charge transaction is closed and the pending amount is tracked.  The payment
 interface (custom extension) must update details corresponding
 to payment through the <code>recordExternalCharges</code> API. This is
 typical when interfaces to the payment system are
 run in batch mode.<br />
 <p>When performing asynchronous payment processing, <code>recordCollection</code> may be used as an alternative to <code>executeCollection</code>.  
 Both APIs operate on open charge transactions and mark the charge requests as <code>CLOSED</code> upon API completion; only one of the <code>recordCollection</code> and <code>executeCollection</code> APIs may be run for asyncronous payment processing.  See <a href="recordCollection.html">recordCollection</a> for more information.</p>
</ul><br></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>env</code> - Environment handle returned by the <code>createEnvironment</code> API. This is a mandatory parameter.</dd>
<dd><code>inXML</code> - Required. For more information, see the associated <a href="#xmltable">input xml files</a>.
<br>
<br></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>An XML document that contains details of the results of collection. For details on the output, refer to the associated  <a href="#xmltable">output xml files</a>.
<br><br></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><b>YFSException</b></code> - Exception containing error codes in the standard  <a href="#xmltable">error files</a>.
<br></dd>
<dd><code><b>RemoteException</b></code> - Java's default remote exception handler.</dd>
<dd><code>com.yantra.yfs.japi.YFSException</code></dd>
<dd><code>java.rmi.RemoteException</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div role="navigation" title ="Bottom_NAVIGATION" aria-label ="Bottom Navigation Bar"/>
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>IBM Corp. Confidential</b></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/yantra/api/omp/payment/computeRefundPayments.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/yantra/api/omp/payment/executePaymentTransactions.html" title="interface in com.yantra.api.omp.payment"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/yantra/api/omp/payment/executeCollection.html" target="_top">Frames</a></li>
<li><a href="executeCollection.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<div role="contentinfo" title ="contentinfo_title" aria-label ="Contains footer note"/>
<p class="legalCopy"><small><font face='Verdana' size='1'>&#169; Copyright IBM Corp. 2001, 2013 All Rights Reserved. </font></small></p>
</body>
</html>
